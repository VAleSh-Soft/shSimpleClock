## shSimpleClock - библиотека, реализующая часы на модуле DS3231

- [Описание](#описание)
- [История версий](#история-версий)
- [Используемые экраны](#используемые-экраны)
  - [Матрица на адресных светодиодах](#матрица-на-адресных-светодиодах)
- [Управление](#управление)
- [Использованные сторонние библиотеки](#использованные-сторонние-библиотеки)

### Описание

Библиотека позволяет легко и быстро создавать часы с использованием часового модуля (RTC) **DS3231**, нескольких типов экранов и различным набором опций (календарь, будильник, датчики освещенности и температуры и т.д) на выбор пользователя.

В базовом варианте (на семисегментном экране **TM1637**, без календаря, будильника и датчиков освещения и температуры) часы помещаются в **ATmega8**/**ATmega88** (возможно, без загрузчика), но проверить работу на этих контроллерах возможности не было.

Все базовые настройки часов, как то: используемый экран, используемый набор опций, используемые датчики, пины для подключения периферии - задаются в файле **clockSetting.h**, который нужно поместить в папку со скетчем.<br>
**ВАЖНО:** объявление файла **clockSetting.h** в скетче должно быть **ДО** объявления библиотеки **shSimpleClock.h** (пример см. ниже):

```
#include "clockSetting.h"
#include <shSimpleClock.h>
```

Образец файла **clockSetting.h** идет вместе с библиотекой.

### История версий

Версия 1.0 -
 + первая версия;

### Используемые экраны

В часах могут быть использованы либо семисегментый экран на базе драйвера **TM1637**, либо экраны на базе драверов **MAX7219** или **MAX7221**, как в виде семисегментного экрана на четыре цифры, так и светодиодных матриц 8х8 (четыре модуля), либо матрица 8х32, составленная из адресных светодиодов. Для выбора требуемого экрана нужно раскомментировать одну из нижеследующих строк (закомментировав остальные) в файле **clockSetting.h**.
- `#define TM1637_DISPLAY`
- `#define MAX72XX_7SEGMENT_DISPLAY`
- `#define MAX72XX_MATRIX_DISPLAY`
- `#define WS2812_MATRIX_DISPLAY`

#### Матрица на адресных светодиодах

Для работы с таким матрицами используется библиотека **FastLED**. Поддерживаются все виды чипов, поддерживаемых библиотекой **FastLED**, все настройки чипов матрицы находятся в файле **clockSetting.h**.

Нужный тип указывается в строке `#define CHIPSET_WS2812B`; возможные варианты чипсетов указаны в комментарии к строке.

В строке `#define EORDER GRB` указывается порядок следования цветов.

Для адресных светодиодов с четырехпроводной схемой управления раскомментируйте строку `// #define USE_HARDWARE_SPI`, если для управления светодиодами будет использоваться аппаратный SPI вашего микроконтроллера, в этом случае указывать номера пинов для подключения матрицы не нужно, подключайте ее к пинам аппаратного SPI (см. даташиты используемых чипов и используемого МК).

Матрица может быть построена как построчно (`BY_LINE`), так и по столбцам (`BY_COLUMNS`); начальная точка - верхний левый пиксель; нужный порядок указывается в строке `#define MX_TYPE BY_COLUMNS`.

В строке `#define COLOR_OF_NUMBER CRGB::Red` нужно указать желаемый цвет выводимой информации; так же цвет может быть установлен программно.

### Управление

Часы управляются тремя кнопками: **Set** - вход в режимы настроек и сохранение изменений; **Up** - увеличение текущих значений; **Down** - уменьшение текущих значений; Для работы с кнопками используется библиотека **shButton**.

Вход во все режимы настроек выполняется из режима отображения текущего времени:
- настройки текущего времени и даты (при использовании календаря) - длинный клик кнопкой **Set**;
- настройки будильника (если используется) - двойной клик (или одиночный короткий клик, если используется соответствующая опция) кнопкой **Set**;
- настройки уровней яркости экрана и порог переключения (если используются соответствующие опции) - одновременное удержание нажатыми кнопок **Up** и **Down**;
- настройка прочих опций - длинный клик кнопкой **Down**;

**ВАЖНО:** для корректной работы кнопок их опрос нельзя проводить более, чем один раз за один проход `loop()`, поэтому для использования событий кнопок в других целях библиотека имеет соответствующие методы, возвращающие текущее состояние или событие кнопок. Образец использования см. в примерах.

### Использованные сторонние библиотеки

**shButton.h** - https://github.com/VAleSh-Soft/shButton<br>

Для работы с модулем **DS3231** используется библиотека<br>
**DS3231.h** - https://github.com/NorthernWidget/DS3231<br>

Для работы с экранами используются библиотеки<br>
**TM1637Display.h** - https://github.com/avishorp/TM1637<br>
или<br>
**shMAX72xxMini.h** - https://github.com/VAleSh-Soft/shMAX72xxMini<br>
или <br>
**FastLED.h** - https://github.com/FastLED/FastLED<br>

для работы с датчиком **DS18b20** используется библиотека<br>
**OneWire.h** - https://github.com/PaulStoffregen/OneWire

<hr>

Если возникнут вопросы, пишите на valesh-soft@yandex.ru 

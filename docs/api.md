## Взаимодействие с внешним кодом (API библиотеки)

- [Необходимый минимум](#необходимый-минимум)
- [Экран](#экран)
  - [Текущий режим экрана](#текущий-режим-экрана)
  - [Матрица на драйверах MAX7219/7221](#матрица-на-драйверах-max72197221)
  - [Матрица на адресных светодиодах](#матрица-на-адресных-светодиодах)
- [Текущие настройки часов](#текущие-настройки-часов)
  - [Время и дата](#время-и-дата)
  - [Температура](#температура)
  - [Будильник](#будильник)
- [Кнопки](#кнопки)
- [Смотри так же](#смотри-так-же)

### Необходимый минимум

Библиотека **shSimpleClock** позволяет легко и быстро создавать электронные часы без написания дополнительного кода. Простейший скетч часов выглядит так:
```
#include "clockSetting.h"
#include <shSimpleClock.h>

// объявляем экземпляр часов
shSimpleClock clock;

void setup()
{
  // инициализируем часы
  clock.init();
}

void loop()
{
  // обработка событий часов
  clock.tick();

}
```
Этого достаточно для создания часов с любым набором опций и поддерживаемой периферии (датчики, экраны, кнопки). Все настройки часов описываются в файле [**clockSetting.h**](clock_setting.md), который должен лежать рядом с файлом скетча. Часы абсолютно самодостаточны и не требуют вмешательства в их работу, вы можете совершенно спокойно писать код своей программы в скетче, не обращая внимания на код часов. Однако, если вам все-таки нужно взаимодействовать с часами - получать текущее время, обрабатывать события кнопок и т.д., и т.п., библиотека предоставляет вам все необходимые для этого инструменты.

### Экран

#### Текущий режим экрана

Метод
```
clkDisplayMode getDisplayMode();
```
позволяет получать текущий режим работы экрана, а метод
```
void setDisplayMode(clkDisplayMode _mode);
```
позволяет установить другой режим. 

Например, код
```
clock.setDisplayMode(DISPLAY_MODE_SHOW_TEMP);
```
на несколько секунд выведет на экран часов текущую температуру (если эта опция используется).

**Важно:** таким же образом можно переводить часы в режимы настроек (времени, будильника и т.д., и т.п.), однако изменять настраиваемые опции все равно придется кнопками. Но все эти параметры можно настраивать и программно, не вызывая интерфейсы настроек на экран (см. [здесь](#текущие-настройки-часов)).

Методы
```
uint8_t getBrightnessMax();
void setBrightnessMax(uint8_t _br);
uint8_t getBrightnessMin();
void setBrightnessMin(uint8_t _br);
```
позволяют получить и установить максимальную и минимальную яркости экрана. Последние два метода доступны только при использовании датчика освещенности. Для экранов на основе драйвера **TM1637** яркость может задавать в интервале **1..7**, для экранов на основе драйвера **MAX7219**/**MAX7221** - **0..15**, для матриц на основе адресных светодиодов - **1..25**.

#### Матрица на драйверах MAX7219/7221

Для светодиодных матриц, построенных на драйверах **MAX7219**/**MAX7221** могут пригодиться следующие методы:
```
void setMatrixDirection(uint8_t _dir);
```
поворот изображения, параметр `_dir` может принимать значения **1..3**.
```
void setMatrixFlipMode(bool _mode);
```
зеркальное отражение по горизонтали (построчно). 

Дело в том, что, если вы используете готовые китайские матрицы на четыре модуля 8х8, например, такие

![](0004.jpg)

то скорее всего столкнетесь с проблемой, когда изображение, вместо того, чтобы располагаться вдоль матрицы, разбивается на четыре части, повернутые на 90 градусов, а то и зеркально отраженные. В этом случае приведенные выше методы позволяют привести ориентацию изображения в норму.

Кроме того, задать нужные поворот и отражение можно в файле [**clockSetting.h**](clock_setting.md).

#### Матрица на адресных светодиодах

Для матриц, основанных на адресных светодиодах доступны дополнительные методы:
```
void setColorOfNumber(CRGB _color);
void setColorOfBackground(CRGB _color);
```
позволяют устанавливать цвет символов и цвет фона соответственно. А метод:
```
void setMaxPSP(uint8_t volts, uint32_t milliamps);
```
позволяет установить параметры блока питания - напряжение (обычно 5v) и максимальную силу тока, которую может отдать блок питания (в милиамперах). Это позволит уберечь блок питания от перегрузки и выхода из строя.

### Текущие настройки часов

#### Время и дата

Метод
```
DateTime getCurrentDateTime();
```
позволяет получить текущие дату и время. 

Методы
```
void setCurrentTime(uint8_t _hour, uint8_t _minute, uint8_t _second);
void setCurrentDate(uint8_t _date, uint8_t _month);
void setCurrentYear(uint8_t _year);
```
позволяют установить текущие время, дату месяца и год соответственно. Последние два метода доступны, если используется опция `USE_CALENDAR`.

#### Температура

Метод
```
int8_t getTemperature();
```
позволяет получить текущую температуру с используемого датчика. Температура возвращается в целых градусах.

#### Будильник

Методы
```
uint16_t getAlarmPoint();
void setAlarmPoint(uint16_t _point);
void setAlarmPoint(uint8_t _hour, uint8_t _minute);
```
позволяют получить и установить время срабатывания будильника. В первых двух методах время задается количеством минут от начала суток (`hour * 60 + minute`), в третьем - в более привычном виде.

Методы
```
bool getOnOffAlarm();
void setOnOffAlarm(bool _state);
```
позволяют узнать, включен или нет будильник, и включить/отключить его соответственно.

Метод
```
AlarmState getAlarmState()
```
получает текущий статус будильника, что позволяет отслеживать срабатывание; возвращает 
- **ALARM_OFF(0)** - будильник выключен, 
- **ALARM_ON(1)** - будильник включен, 
- **ALARM_YES(2)** - будильник сработал;

Метод
```
void buzzerStop();
```
отключает сигнал сработавшего будильника.

### Кнопки

Для работы с кнопками предусмотрены три метода:
```
uint8_t getBtnSetState();
uint8_t getBtnUpState();
uint8_t getBtnDownState();
```
позволяющие получить текущий статус или событие кнопок **Set**, **Up** и **Down** соответственно.

<hr>

### Смотри так же
- [Главная страница](../readme.md)
- [Используемые модули RTC](rtc.md)
- [Используемые в часах экраны](displays.md)
- [Управление часами - кнопки](buttons.md)
- Дополнительные опции:
  - [Календарь](calendar.md)
  - [Будильник](alarm.md)
  - [Регулировка уровней яркости экрана](br_adjust.md)
  - [Отображение температуры](show_temp.md)
  - [Опции для матричных экранов](matrix.md)
- Внешние датчики:
  - [Датчик освещенности](light_sensor.md)
  - [Датчики температуры](temp_sensors.md)
- [Описание файла `clockSetting.h`](clock_setting.md)

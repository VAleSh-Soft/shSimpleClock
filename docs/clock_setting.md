## Описание файла `clockSetting.h`

- [Для чего он нужен?](#для-чего-он-нужен)
- [Блок "экран часов"](#блок-экран-часов)
  - [Матрица из адресных светодиодов](#матрица-из-адресных-светодиодов)
  - [Опции для матричных экранов](#опции-для-матричных-экранов)
- [Блок "кнопки"](#блок-кнопки)
- [Блок "дополнительные опции"](#блок-дополнительные-опции)
  - [Календарь](#календарь)
  - [Будильник](#будильник)
  - [Режим настройки уровней яркости](#режим-настройки-уровней-яркости)
  - [Вывод температуры](#вывод-температуры)
- [Блок "пищалка"](#блок-пищалка)
- [Блок "датчики"](#блок-датчики)
  - [Датчик освещенности](#датчик-освещенности)
  - [Датчики температуры](#датчики-температуры)
    - [DS18B20](#ds18b20)
    - [NTC термистор](#ntc-термистор)
- [Блок "прочие настройки"](#блок-прочие-настройки)
- [Блок "настройки EEPROM"](#блок-настройки-eeprom)
- [Блок "модуль RTC"](#блок-модуль-rtc)
- [Блок "служебная информация"](#блок-служебная-информация)
- [Смотри так же](#смотри-так-же)

### Для чего он нужен?

Все базовые настройки часов, как то: используемые модули, используемый набор опций, пины для подключения периферии - задаются в файле **clockSetting.h**, который нужно поместить в папку со скетчем. Закомментировав ненужные опции и, наоборот, раскомментировав нужные, вы получите часы с нужным вам функционалом.

**ВАЖНО:** объявление файла **clockSetting.h** в скетче должно быть **ДО** объявления библиотеки **shSimpleClock.h** (пример см. ниже):

```
#include "clockSetting.h"
#include <shSimpleClock.h>
```

Образец файла **clockSetting.h** идет вместе с библиотекой.

Файл разбит на блоки настроек. Поблочно и будем его описывать

### Блок "экран часов"

Строка
```
#define TM1637_DISPLAY
```
задает, какой экран используется часами. Библиотека позволяет использовать либо семисегментый экран на базе драйвера **TM1637**, либо экраны на базе драверов **MAX7219**/**MAX7221**, как в виде семисегментного экрана на четыре цифры, так и светодиодных матриц 8х8 (четыре модуля), либо матрица 8х32, составленная из адресных светодиодов.

Всего возможны четыре варианта, все они описаны в комментарии к строке: 
- `TM1637_DISPLAY`
- `MAX72XX_7SEGMENT_DISPLAY`
- `MAX72XX_MATRIX_DISPLAY`
- `WS2812_MATRIX_DISPLAY`

Для экранов на базе **TM1637** и **MAX7219**/**MAX7221** в этом блоке нужно указать только номера пинов, к которым будут подключаться экраны. При этом имейте в виду, что драйвера **MAX7219**/**MAX7221** работают через аппаратный **SPI** вашего микроконтроллера. 

#### Матрица из адресных светодиодов

Строка
```
#define CHIPSET_WS2812B
```
определяет, какой чип используется в адресных светодиодах матрицы. Возможных вариантов много, поддерживаемые чипы перечислены в комментарии к строке.

Второй важный параметр - очередность следования цветов в чипе, задается в строке
```
#define EORDER GRB
```
Определить нужный порядок просто - если вы, например, указали порядок следования **GRB**, задали цвет символов **CRGB::Red** (красный цвет), а цифры на экране рисуются зеленым, попробуйте поменять порядок следования на **RGB**.

Если вы используете адресные светодиоды с четырехпроводной схемой подключения и хотите подключить их к аппаратному **SPI** вашего микроконтроллера, раскомментируйте строку
```
#define USE_HARDWARE_SPI
```
В этом случае указывать номера пинов для подключения матрицы в файле **clockSetting.h** не нужно.

Далее указывается порядок построения матрицы, который задается в строке
```
#define MX_TYPE BY_COLUMNS
```
Матрица может быть построена как построчно (`BY_LINE`), так и по столбцам (`BY_COLUMNS`); начальная точка - верхний левый пиксель.

Строки
```
#define COLOR_OF_NUMBER CRGB::Red
```
и
```
#define COLOR_OF_BACKGROUND CRGB::Black
```
задают цвета символов и фона матрицы соответственно. Так же эти параметры можно менять программно в процессе выполнения программы.

Строки
```
#define POWER_SUPPLY_VOLTAGE 5
```
и
```
#define POWER_SUPPLY_CURRENT 2000
```
задают параметры блока питания матрицы - напряжение в вольтах и максимальную силу тока в милиамперах. Эти параметры позволяют уберечь блок питания от перегрузки и выхода из строя.

Далее указывается пин/пины для подключения матрицы.

#### Опции для матричных экранов

Матричные экраны, в отличие от семисегментных индикаторов, позволяют выводить полноценные текстовые символы, поэтому имеют дополнительные настройки.

Строка 
```
#define USE_RU_LANGUAGE
```
указывает, что для вывода дней недели и прочей информации будут использоваться символы кириллицы. Если вам это не нужно, закомментируйте эту строку, информация будет выводиться по английски.

Строка 
```
#define USE_TICKER_FOR_DATA
```
позволяет анимировать вывод информации бегущей строкой. Если закомментировать эту строку, то информация будет просто сменять друг друга.

Строка 
```
#define TICKER_SPEED 100
```
задает скорость бегущей строки в кадрах в секунду. 

Строка 
```
#define SHOW_SECOND_COLUMN
``` 
включает вывод в крайнем правом столбце экрана столбца светодиодов, отображающих количество прошедших секунд в минуте. Первые полминуты каждые пять секунд световой столбец увеличивается на один светодиод снизу вверх, со второй половины минуты световой столбец каждые пять секунд уменьшается на один светодиод снизу вверх.

### Блок "кнопки"

Здесь задаются параметры кнопок, которыми будут управляться часы.

Строка
```
#define BTN_INPUT_TYPE PULL_UP
```
определяет тип подключения кнопки (см. комментарий к строке с указанием возможных вариантов).

В строке 
```
#define BTN_TYPE BTN_NO
```
задается тип кнопки (так же см. комментарий к строке с указанием возможных вариантов).

Строки
```
uint16_t constexpr TIMEOUT_OF_LONGCLICK = 1000; 
uint16_t constexpr INTERVAL_OF_SERIAL = 100;    
uint16_t constexpr TIMEOUT_OF_DEBOUNCE = 50;    
```
задают настройки кнопок - интервал удержания кнопки нажатой, интервал выдачи событий **BTN_LONGCLICK** при удержании кнопки нажатой, интервал антидребезга соответственно. Все настройки задаются в милисекундах.

Строка 
```
#define USE_BUZZER_FOR_BUTTON
```
определяет, будет ли озвучиваться каждый клик кнопки. Конечно, для этого в системе должна присутствовать пищалка, и должен быть определен пин, к которому она подключена.

Пины для подключения кнопок задаются в строках
```
#define BTN_SET_PIN 4 
#define BTN_DOWN_PIN 6 
#define BTN_UP_PIN 9 
```
если какая-то из кнопок не будет использоваться, вместо номера можно задать -1.

### Блок "дополнительные опции"

#### Календарь

Строка
```
#define USE_CALENDAR
```
добавляет в часы функционал календаря. Вывод даты на экран выполняется кликом кнопкой **Down**. Дополнительно добавляется интерфейс для настройки текущей даты. В режим настройки даты часы переходят по короткому клику кнопкой **Set** из режима настройки минут или по длинному клику кнопкой **Set** из режима отбражения календаря.

#### Будильник

Строка
```
#define USE_ALARM
```
добавляет часам функционал будильника. Дополнительно добавляется интерфейс настройки будильника.

Строки
```
uint8_t constexpr ALARM_DURATION = 60;
uint8_t constexpr ALARM_SNOOZE_DELAY = 120;
uint8_t constexpr ALARM_REPETITION_COUNT = 3;
```
задают длительность сигнала будильника в секундах, задержку перед следующим срабатыванием в секундах, если сигнал не был отключен, и количество повторов сигнала. Т.е. если сигнал не отключать, то он сработает три раза по минуте с интервалом между срабатыванием в две минуты.

Строка
```
#define USE_ONECLICK_TO_SET_ALARM
```
позволяет входить в настройки будильника по однократному клику кнопкой **Set** вместо двойного клика, принятого по умолчанию.

Строка
```
#define ALARM_LED_PIN 7
```
задает пин для подключения светодиода-индикатора состояния будильника.

#### Режим настройки уровней яркости

Строка
```
#define USE_SET_BRIGHTNESS_MODE
```
добавляет часам функционал регулировки яркости экрана. В этом случае при использовании датчика света можно будет настраивать как минимальный, так и максимальный уровни, иначе можно будет настроить только максимальный уровень яркости экрана.

Вход в режим настройки яркости выполняется по удержанию одновременно нажатыми кнопок **Up** и **Down**.

#### Вывод температуры

Строка
```
#define USE_TEMP_DATA
```
добавляет возможность выводить на экран температуру воздуха в помещении по клику кнопкой **Up**.

### Блок "пищалка"

Пищалка может использоваться как будильником, так и кнопками для озвучивания клика (например, если вы используете сенсорные кнопки). Пин для подключения пищалки задается строкой
```
#define BUZZER_PIN 5 
```

### Блок "датчики"

#### Датчик освещенности

Строка
```
#define USE_LIGHT_SENSOR
```
добавляет возможность автоматически снижать яркость экрана при низком освещении; так же добавляется интерфейс настройки порога переключения яркости экрана. Вход в режим настройки порога переключения яркости выполняется по удержанию одновременно нажатыми кнопок **Up** и **Down**.

Строка
```
#define LIGHT_SENSOR_PIN A3 
```
определяет аналоговый пин, к которому будет подключен датчик. Схему подключения датчика см. [здесь](light_sensor.md).

#### Датчики температуры

##### DS18B20

Строка
```
#define USE_DS18B20
```
позволяет использовать для вывода температуры датчик **DS18b20** и некоторые другие датчики из этой серии.

Строка
```
#define DS18B20_PIN 8
```
определяет пин, к которому подключается линия данных дачика

##### NTC термистор

Строка
```
#define USE_NTC
```
позволяет использовать в качестве датчика температуры NTC-термистор

Для использования термистора нужно знать его сопротивление при комнатной (25 градусов Цельсия) температуре и точное сопротивление второго резистора в делителе напряжения (и то, и другое - в Омах). Также нужно знать бета-коэффициент термистора - он отражает изменение сопротивления термистора при изменении температуры; значение коэффициента можно узнать у производителя датчика или рассчитать (см. описание в файле **ntc.h**). Все эти данные описываются в строках
```
uint16_t constexpr RESISTOR_STD = 10000;
uint16_t constexpr BALANCE_RESISTOR = 9850;
uint16_t constexpr BETA_COEFFICIENT = 3950;
```
соответственно

Строка
```
uint8_t constexpr BIT_DEPTH = 10; 
```
задает разрядность АЦП вашего микроконтроллера.

Строка
```
#define NTC_PIN A0 
```
задает аналоговый пин, к которому подключается датчик.

Схемы подключения температурных датчиков см. [здесь](temp_sensors.md).

### Блок "прочие настройки"

Строка
```
#define AUTO_EXIT_TIMEOUT 6
```
задает время в секундах, по истечение которого часы возвращаются в режим показа времени из любого другого режима при отсутствии активности пользователя.

### Блок "настройки EEPROM"

```
#define INTERVAL_FOR_AUTOSHOWDATA_EEPROM_INDEX 96
```
индекс ячейки в **EEPROM** для сохранения интервала автовывода даты и/или температуры на экран (uint8_t); имеет смысл только при использовании одной из опций `USE_CALENDAR` или `USE_TEMP_DATA`.

```
#define TICKER_STATE_VALUE_EEPROM_INDEX 97  
```
индекс ячейки в **EEPROM** для сохранения статуса анимации (uint8_t); имеет смысл только при использовании опции `#define USE_TICKER_FOR_DATA`.

```
#define LIGHT_THRESHOLD_EEPROM_INDEX 95
```
индекс ячейки в **EEPROM** для сохранения порога переключения яркости экрана (uint8_t); имеет смысл только при использовании опции `USE_LIGHT_SENSOR`.

```
#define MIN_BRIGHTNESS_VALUE_EEPROM_INDEX 98 
```
индекс ячейки в **EEPROM** для сохранения  минимального значения яркости экрана (uint8_t); так же имеет смысл только при использовании датчика освещенности.

```
#define MAX_BRIGHTNESS_VALUE_EEPROM_INDEX 99
```
индекс ячейки в **EEPROM** для сохранения  максимального значение яркости экрана (uint8_t).

```
#define ALARM_DATA_EEPROM_INDEX 100
```
индекс первой ячейки в **EEPROM** для сохранения настроек будильника (uint8_t + uint16_t); занимает три ячейки; имеет смысл только при использовании будильника.

```
#define COLOR_OF_NUMBER_VALUE_EEPROM_INDEX 103
```
индекс первой ячейки в **EEPROM** для сохранения цвета символов экрана (uint8_t x 4); занимает четыре ячейки; имеет смысл только при использовании экранов, составленных из адресных светодиодов.

```
#define COLOR_OF_BACKGROUND_VALUE_EEPROM_INDEX 107
```
индекс первой ячейки в **EEPROM** для сохранения цвета фона экрана (uint8_t x 4); занимает четыре ячейки; имеет смысл только при использовании экранов, составленных из адресных светодиодов.


### Блок "модуль RTC"

Строка 
```
#define RTC_DS3231
```
задает тип используемого модуля. Возможны два варианта - **RTC_DS3231** и **RTC_DS1307**. 

Пины для подключения указаны для информации, в коде они нигде не используются. Модули работают через аппаратный **I2C** микроконтроллера, соответственно, к пинам аппаратного **I2C** выбранного МК их и нужно подключать.


### Блок "служебная информация"

Здесь нельзя ничего менять под страхом нарушения работоспособности библиотеки ))

<hr>

### Смотри так же
- [Главная страница](../readme.md)
- [Используемые модули RTC](rtc.md)
- [Используемые в часах экраны](displays.md)
- [Управление часами - кнопки](buttons.md)
- Дополнительные опции:
  - [Календарь](calendar.md)
  - [Будильник](alarm.md)
  - [Регулировка уровней яркости экрана](br_adjust.md)
  - [Отображение температуры](show_temp.md)
  - [Опции для матричных экранов](matrix.md)
- Внешние датчики:
  - [Датчик освещенности](light_sensor.md)
  - [Датчики температуры](temp_sensors.md)
- [Взаимодействие с внешним кодом (API библиотеки)](api.md)
- [Руководство по настройкам часов](setting.md)
